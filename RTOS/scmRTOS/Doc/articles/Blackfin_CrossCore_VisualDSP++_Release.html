<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../misc/favicon.ico"/>
    <title>Blackfin CrossCore VisualDSP++ Release - scmRTOS</title>
    <style type="text/css">/*<![CDATA[*/ @import "../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../skins/common/commonPrint.css" />
          </head>
  <body
    class="ns-4 ns-subject page-scmRTOS_About">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Blackfin CrossCore VisualDSP++ Release</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From scmRTOS</h3>
	    <div id="contentSub"></div>
	    <!-- start content -->
	    <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head><meta http-equiv="content-type" content="charset=utf-8"></head>
<body>
<table id="toc" class="toc"><tr><td>
<div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#General"><span class="tocnumber">1</span> <span class="toctext">General</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Building"><span class="tocnumber">2</span> <span class="toctext">Building</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Assembler_.28easmBLKFN.exe.29"><span class="tocnumber">2.1</span> <span class="toctext">Assembler (easmBLKFN.exe)</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Compiler_.28ccblkfn.exe.29"><span class="tocnumber">2.2</span> <span class="toctext">Compiler (ccblkfn.exe)</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Linker_.28ccblkfn.exe.29"><span class="tocnumber">2.3</span> <span class="toctext">Linker (ccblkfn.exe)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#Utilities"><span class="tocnumber">3</span> <span class="toctext">Utilities</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#vdsp_lst.py"><span class="tocnumber">3.1</span> <span class="toctext">vdsp_lst.py</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#get_info.py"><span class="tocnumber">3.2</span> <span class="toctext">get_info.py</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#ldprg.py"><span class="tocnumber">3.3</span> <span class="toctext">ldprg.py</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#utils.py"><span class="tocnumber">3.4</span> <span class="toctext">utils.py</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<script>if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script><h2> <span class="mw-headline" id="General"> General </span>
</h2>
<p><span>Release consists of the <span title="RTOS: Real Time Operating System;" class="terminologydef" style="cursor:help">RTOS</span> sources and three sample projects - see </span><a href="../articles/Releases.html" title="Releases">Release description</a> for details. Each sample located in separate folder. Structure of sample folder (folders are in brackets '[ ]'):
</p>
<pre> [Config]          - linker scripts and other utilities
 [Exe]             - executable product[s]
 [List]            - listings and other temporary text files
 [Obj]             - objects and other intermediate files
 [Src]             - test project sources
 slon.vpj          - SlickEdit project file
 slon.Blackfin.vpw - SlickEdit workspace file
 SConstruct        - Scons main script file
</pre>
<p><b>slon</b> is test project name.
</p>
<p>Structure of the RTOS folder:
</p>
<pre> scmRTOS
   Common           - common RTOS sources
   BF533            - portable part
</pre>
<p>See <a href="../articles/Releases.html#Distribution" title="Releases">Distribution section</a> and below about release using manners.
</p>
<h2> <span class="mw-headline" id="Building"> Building </span>
</h2>
<p>The simplest way is to employ <a href="http://www.scons.org/" class="external text" rel="nofollow">SCons</a> build system. Scons is actually <a href="http://www.python.org/" class="external text" rel="nofollow">Python</a> script, so Python interpreter is necessary to use SCons. Python interpreter can be downloaded from Python's official site. SCons, in a certain sense, is analog of popular build utility make, but much more powerful because of comprehensive underground of programming language (Python).
</p>
<p>To use SCons:
</p>
<ul>
<li> download and install Python interpreter v2.5.
</li>
<li> download and install SCons tool.
</li>
<li> launch SCons by typing tool name in command line in folder where SConstruct file (SCons main script) located <a href="#a1">(1)</a>.
</li>
</ul>
<pre> $PROMPT$&gt;scons
</pre>
<p>SCons will build the project.
</p>
<p>If user want to use his own build system <a href="#a2">(2)</a> he has to specify the following command-line options for various tools:
</p>
<h3> <span class="mw-headline" id="Assembler_.28easmBLKFN.exe.29"> Assembler (easmBLKFN.exe) </span>
</h3>
<pre> -proc ADSP-BF533
 -si-revision &lt;SiliconRevisionNumber&gt;
 -g
 -o Obj\&lt;src_name&gt;.doj
 -ISrc
 -I../scmRTOS/Common
 -I../scmRTOS/BF533
 -I$TOOLKIT_PATH$\Blackfin\include
</pre>
<h3> <span class="mw-headline" id="Compiler_.28ccblkfn.exe.29"> Compiler (ccblkfn.exe) </span>
</h3>
<pre> -proc ADSP-BF533
 -si-revision &lt;SiliconRevisionNumber&gt;
 -C
 -c
 -g
 -c++
 -Ov 80
 -no-implicit-inclusion  
 -Wsuppress cc1164
 -path-output Obj
 -save-temps
 -ISrc
 -I../scmRTOS/Common
 -I../scmRTOS/BF533
 -I$TOOLKIT_PATH$\Blackfin\include
</pre>
<h3> <span class="mw-headline" id="Linker_.28ccblkfn.exe.29"> Linker (ccblkfn.exe) </span>
</h3>
<pre> -proc ADSP-BF533 
 -si-revision &lt;SiliconRevisionNumber&gt;
 -L Obj 
 -L-L$TOOLKIT_PATH$\Blackfin\lib532_rev_&lt;SiliconRevisionNumber&gt; 
 -save-temps 
 -flags-link -e -jcs2l -T Config/BF533cpp.ldf -map List/slon.xml -o Exe\slon.dxe &lt;list of object files&gt;
</pre>
<p><br>
where <code>$TOOLKIT_PATH$</code> - path to folder with toolkit installed.
</p>
<h2> <span class="mw-headline" id="Utilities"> Utilities </span>
</h2>
<p>Additionally, folder Config contains some useful script utilities that user may take into account. All utilities are Python scripts. This means that Python interpreter must be installed to use the utilities. The utilities are:
</p>
<ul>
<li> <code>vdsp_lst.py</code>
</li>
<li> <code>get_info.py</code>
</li>
<li> <code>ldprg.py</code>
</li>
<li> <code>utils.py</code>
</li>
</ul>
<h3> <span class="mw-headline" id="vdsp_lst.py"> vdsp_lst.py </span>
</h3>
<p>Some compilers produces auxiliary list files, in which source code interleaved with assembler mnemonics. This is convenient thing to inspect codegeneration. Unfortunately, VisualDSP++ Blackfin compiler does not generate such listing file. As maximum, the compiler can generate auxiliary assembler file that contains assembler code with text links to source code, for example:
</p>
<pre> .LN17:
 // "Src\main.cpp" line 125 col 5
      P0.L =  1544;
      P0.H =  -64;
      R0 =  10011 (X);
      [P0+ 0] = R0;
 .LN18:
 // "Src\main.cpp" line 126 col 5
      P1.L =  1548;
      P1.H =  -64;
      R0 =  5000 (X);
      [P1+ 0] = R0;
</pre>
<p><code>vdsp_lst.py</code> just performs source code insertion on base of links, so the above example looks like the following:
</p>
<pre> .LN17:
   MMR32(TIMER0_PERIOD) = 10011; // "Src\main.cpp" line 125 col 5
      P0.L =  1544;
      P0.H =  -64;
      R0 =  10011 (X);
      [P0+ 0] = R0;
 .LN18:
   MMR32(TIMER0_WIDTH)  = 5000; // "Src\main.cpp" line 126 col 5
      P1.L =  1548;
      P1.H =  -64;
      R0 =  5000 (X);
      [P1+ 0] = R0;
</pre>
<p>Using of vdsp_lst.py is very simple: just launch the utility with one argument - compiler generated .s file (to enable generating of .s files command line option -save-temps must be specified).
</p>
<h3> <span class="mw-headline" id="get_info.py"> get_info.py </span>
</h3>
<p>VisualDSP++ linker does not issue any explicit info about code and data sizes of linked project. To get this info the user has to launch elfdump.exe utility from VisualDSP++ toolkit. Unfortunately, elfdump outputs information in uncomfortable format (a lot of service info, hexadecimal representation of sizes, etc.). To fix this inconvenience get_info.py can be used. The utility gets output from elfdump and produces info in human-readable format. See the example below:
</p>
<pre> TotalÂ :  Code: 2394 bytes
          Data: 3436 bytes (Segment A: 3416 bytes. Segment B: 20 bytes.)
</pre>
<pre> ----------------------------------
 Details | Section     | Size
 ----------------------------------
         |  code       | 2394 bytes
         |  data_a     |  228 bytes
         |  data_b     |   20 bytes
         |  bsz_data_a | 3188 bytes
         |  bsz_data_b |    0 bytes
 ----------------------------------
</pre>
<p><code>get_info.py</code> is used in the following manner:
</p>
<p><code>get_info.py dump.txt</code>
</p>
<p>where <code>dump.txt</code> - text file with dump from <code>elfdump.exe</code>. <code>dump.txt</code> can be created by simple redirect elfdump output to file.
</p>
<h3> <span class="mw-headline" id="ldprg.py"> ldprg.py </span>
</h3>
<p><code>ldprg.py</code> is a custom user loader. This utility allows to customize loading process by launch service executable (.dxe) before loading of main executable. This can be useful, for example, in case when the user's program stores data objects in SDRAM - these objects must be initialized (according to C/C++ Standard) and initializing is performed during loading the user's program. So, if at this moment processor's SDRAM controller is not properly set up the initializing process will fail and processor will not start properly.
</p>
<p>Custom loader fixes this situation. The loader allows to run a special service executable before loading main user's executable. This service executable performs SDRAM controller setup (and other actions if need).
</p>
<p>The using of custom user loader is the following:
</p>
<pre> ldprg.py -p &lt;ProcessorName&gt; -i &lt;Initializer FileName&gt; -e &lt;Executable FileName&gt; -s &lt;Session Name&gt;
</pre>
<p>where
</p>
<ul>
<li>&lt;ProcessorName&gt; is name of the used processor. Available Processors are: ADSP-BF531, ADSP-BF532, ADSP-BF533
</li>
<li>&lt;Initializer FileName&gt; is name of service executable (.dxe file)
</li>
<li>&lt;Executable FileName&gt; is name of main executable (.dxe file)
</li>
<li>&lt;Session Name&gt; is name of debug session. Only emulator sessions are suitable.
</li>
</ul>
<h3> <span class="mw-headline" id="utils.py"> utils.py </span>
</h3>
<p>VisualDSP++ compiler performs error message line wrapping, so error message often occupies several (two or more) lines. Some powerful 3rd party programmer's editors uses status line to show error message text when error locator opens source file with error. At that moment the only first line of error message is displayed in status line. This is very inconvenient.
</p>
<p><code>utils.py</code> contains function handle_err() that performs error message unwrapping. The using of the function is very simple:
</p>
<pre> oerr = utils.handle_err(out)
 where out  - compiler's stderr stream,
       oerr - the same stream with error/warning lines unwrapped.
</pre>
<p>This function cannot be used standalone - it can be used only inside Python script.
</p>
<p><b>Note</b>
When using Scons to build the project the above utilities (except ldprg.py) are run automatically.
</p>
<p><br></p>
<hr>
<p><span id="a1"></span>[1] SConstruct file contains variable TOOLKIT_PATH that specifies path to toolkit on particular PC. The user should correct this path according to his PC toolkit location. The path can be specified directly or through system environment variables as well.
</p>
<p><span id="a2"></span>[2] For example, make utility or simple bat file.
</p>
</body>
</html>

<!-- 
NewPP limit report
Preprocessor node count: 40/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->
<div class="printfooter">
</div>
	    <div id="catlinks"><div id='catlinks' class='catlinks catlinks-allhidden'></div></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../misc/scmrtos.png);"
	    href="../index.html"
	    title="ScmRTOS"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Home"><a href="../index.html">Home</a></li>
	     	      <li id="n-Ports"><a href="../articles/Ports.html">Ports</a></li>
	     	      <li id="n-Releases"><a href="../articles/Releases.html">Releases</a></li>
	     	      <li id="n-Documentation"><a href="../articles/Documentation.html">Documentation</a></li>
	     	      <li id="n-Tools"><a href="../articles/Tools.html">Tools</a></li>
	     	      <li id="n-currentevents"><a href="../articles/scmRTOS%7ECurrent_events.html">Current events</a></li>
	     	      <li id="n-Team"><a href="../articles/Team.html">Team</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-support'>
	  <h5>support</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-help"><a href="../articles/Help%7EContents.html">Help</a></li>
	     	      <li id="n-Browse-Subversion-repository"><a href="http://scmrtos.svn.sourceforge.net/viewvc/scmrtos/">Browse Subversion repository</a></li>
	     	      <li id="n-Downloads"><a href="http://sourceforge.net/projects/scmrtos/files/">Downloads</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-development'>
	  <h5>development</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Bug-tracker"><a href="http://sourceforge.net/tracker/?func=browse&amp;group_id=181958&amp;atid=899286">Bug tracker</a></li>
	     	    </ul>
	  </div>
	</div>
		      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
		  	  	  <li id="f-about"><a href="../articles/scmRTOS%7EAbout.html" title="scmRTOS:About">About scmRTOS</a></li>	  	  	</ul>
      </div>
    </div>
  </body>
</html>
